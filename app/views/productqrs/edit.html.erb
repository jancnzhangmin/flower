<%= render 'layerbegin' %>



<div class="page-content">


  <div class="row">
    <div class="col-xs-12">
      <div class="alert alert-block alert-success" style="display:none;">
        <button type="button" class="close" data-dismiss="alert">
          <i class="icon-remove"></i>
        </button>

        <p>
          <strong>
            <i class="icon-ok"></i>
          </strong>
          保存成功
        </p>

      </div>

      <%= form_with(model:[@product,@productqr],local:true,:html => {:class=>'form-horizontal m-t',:multipart => true}) do |f| %>
        <h3 class="header smaller lighter blue">
          海报
          <small></small>
        </h3>
        <div class="form-group">
          <label class="col-sm-2 control-label no-padding-right" for="form-field-1"> 海报背景 </label>
          <div class="col-sm-10">
            <%= f.file_field :productqrbase,class:"col-xs-10 col-sm-8" %>
          </div>
        </div>

        <div class="col-md-12" style="padding: 20px;">
          <canvas id="canvas" width="360px" height="640px">

          </canvas>
        </div>


        <div class="clearfix form-actions">
          <div class="col-md-offset-2 col-md-10">
            <button type="submit" name="commit" value="保存" class="btn btn-info" data-disable-with="保存" id="submit">
              <i class="icon-ok bigger-110"></i>
              保存
            </button>

          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
    $(document).ready(function(){
        var canvas = new fabric.Canvas('canvas');

        fabric.Image.fromURL('<%= Config.last.headdemo.url %>', function(headdemo) {
            headdemo.scale(0.5).set({
                left: 20,
                top: 20,
                clipTo: function (ctx) {
                    ctx.arc(0, 0, 65, 0, Math.PI * 2, true);
                }
            });
            canvas.add(headdemo);
        });

        fabric.Image.fromURL('<%= Config.last.qrdemo.url %>', function(qrdemo) {
            qrdemo.scale(0.4).set({
                left: 220,
                top: 505
            });
            canvas.add(qrdemo);
        });

        var nickname = new fabric.Textbox('风信子', {
            left: 100,
            top: 30,
            fill: '#fff'
        });
        nickname.setShadow({
            color: 'rgba(0,0,0,0.3)',
            offsetX:2,
            offsetY:1
        });
        nickname.scale(0.4);
        canvas.add(nickname);

        var vid = new fabric.Textbox('10001', {
            left: 100,
            top: 55,
            fill: '#fff'
        });
        vid.setShadow({
            color: 'rgba(0,0,0,0.3)',
            offsetX:2,
            offsetY:1
        });
        vid.scale(0.4);
        canvas.add(vid);

        fabric.Image.fromURL('<%= @productqr.productqrbase.url  %>', function(img) {
            img.set({ left: 0, top: 0}).scale(0.5);
            canvas.backgroundImage = img;
        });
    });


</script>

<%= render 'layerend' %>